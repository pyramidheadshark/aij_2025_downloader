# AI Journey 2025 Pipeline: Downloader, Transcriber & Editor

Полностью автономный и автоматизированный пайплайн для обработки материалов конференции AI Journey.
Система выполняет полный цикл: от скачивания видео с защищенного плеера до генерации чистого, выверенного и готового к анализу текста.

## Архитектура пайплайна

1. **01_downloader.py**: Обходит защиту плеера (Playwright), скачивает видеопотоки (HLS), сжимает их (FFmpeg) и организует по папкам.
2. **02_extractor.py**: Извлекает аудиодорожки и конвертирует их в WAV (16kHz, mono) для ML-моделей.
3. **03_transcriber.py**: Распознает речь с помощью модели **GigaAM-v3 (CTC)**. Использует chunking для экономии VRAM и умную склейку (overlap) для бесшовного текста.
4. **04_editor.py**: Финальная обработка текста через локальную LLM **GigaChat3-10B (GGUF)**. Реализует:
    * **Дедупликацию** для обработки объединенных лекций только один раз.
    * **Sliding Window** для обработки длинных текстов без потери контекста.
    * Расстановку пунктуации, исправление ошибок ASR и форматирование.
5. **05_evaluator.py**: **Контроль качества**. Сравнивает исходные и отредактированные тексты по ключевым метрикам (семантическое сходство, читаемость, статистика) для валидации работы редактора.

## Требования

* **OS**: Windows / Linux
* **Python**: 3.10+
* **GPU**: NVIDIA (рекомендуется **8GB+ VRAM** для GigaAM и GigaChat).
* **FFmpeg**: Должен быть установлен в системе или лежать в корне проекта.

## Установка

1. **Клонировать репозиторий:**

    ```bash
    git clone https://github.com/pyramidheadshark/aij_2025_downloader.git
    cd aij_2025_downloader
    ```

2. **Настройка окружения:**
    * Скачайте `ffmpeg.exe` и положите в корень проекта (если он не установлен глобально).
    * Создайте папку `models/` в корне проекта.
    * Скачайте GGUF-модель **`gigachat3-10b-a1.8b-q5_k_m.gguf`** из репозитория [NikolayKozloff/GigaChat3-10B-A1.8B-Q5_K_M-GGUF](https://huggingface.co/NikolayKozloff/GigaChat3-10B-A1.8B-Q5_K_M-GGUF) и поместите ее в папку `models/`.

3. **Установка зависимостей:**
    * Установите основные пакеты:

        ```bash
        pip install -r requirements.txt
        playwright install chromium
        ```

    * **(Критически важно)** Установите `llama-cpp-python` с поддержкой CUDA. Это требует компиляции. Выполните в терминале (пример для Windows):

        ```bash
        # Убедитесь, что у вас установлен CUDA Toolkit и C++ Build Tools
        $env:CMAKE_ARGS="-DLLAMA_CUBLAS=on"
        $env:FORCE_CMAKE=1
        pip install --upgrade --force-reinstall llama-cpp-python --no-cache-dir
        ```

## Структура проекта

```text
.
├── config.py           # Единый файл конфигурации (пути, модели, настройки)
├── 01_downloader.py    # Этап 1: Скачивание видео
├── 02_extractor.py     # Этап 2: Конвертация в WAV
├── 03_transcriber.py   # Этап 3: Speech-to-Text (GigaAM)
├── 04_editor.py        # Этап 4: AI Редактура (GigaChat)
├── 05_evaluator.py     # Этап 5: Оценка качества
├── data/               # Входные данные (schedule.json)
├── models/             # Место для скачанной GGUF-модели
├── output_video/       # Видео (Результат этапа 1)
├── output_audio/       # Аудио (Результат этапа 2)
├── output_stt/         # Сырой текст (Результат этапа 3)
└── output_clean/       # ИТОГОВЫЙ ТЕКСТ (Результат этапа 4)
```

## Использование (Полный цикл)

### Этап 1: Скачивание видео

```bash
python 01_downloader.py download --all
```

### Этап 2: Подготовка аудио

```bash
python 02_extractor.py
```

### Этап 3: Транскрибация (STT)

```bash
# Тестовый прогон на одном файле
python 03_transcriber.py --test

# Полный запуск
python 03_transcriber.py
```

### Этап 4: Локальная редактура (LLM)

```bash
# Запускает GigaChat3 для очистки и форматирования всех текстов
python 04_editor.py
```

*Флаг:* `--force`: Перезаписать уже отредактированные файлы.

### Этап 5: Оценка качества (QC)

```bash
# Запускает анализ и создает отчет
python 05_evaluator.py --output report.csv
```

Результатом будет сводка в консоли и детальная таблица `report.csv`, показывающая, насколько хорошо редактор сохранил смысл исходных текстов.
